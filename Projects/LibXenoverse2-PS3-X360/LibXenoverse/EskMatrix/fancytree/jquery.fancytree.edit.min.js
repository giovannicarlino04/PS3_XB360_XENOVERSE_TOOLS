/*!
 * jquery.fancytree.edit.js
 *
 * Make node titles editable.
 * (Extension module for jquery.fancytree.js: https://github.com/mar10/fancytree/)
 *
 * Copyright (c) 2008-2018, Martin Wendt (http://wwWendt.de)
 *
 * Released under the MIT license
 * https://github.com/mar10/fancytree/wiki/LicenseInfo
 *
 * @version 2.30.0
 * @date 2018-09-02T15:42:49Z
 */
(function(e){"function"==typeof define&&define.amd?define(["jquery","./jquery.fancytree"],e):"object"==typeof module&&module.exports?(require("./jquery.fancytree"),module.exports=e(require("jquery"))):e(jQuery)})(function(e){"use strict";var t=/Mac/.test(navigator.platform),i=e.ui.fancytree.escapeHtml,n=e.ui.fancytree.unescapeHtml;return e.ui.fancytree._FancytreeNodeClass.prototype.editStart=function(){var t,i=this,r=this.tree,s=r.ext.edit,a=r.options.edit,o=e(".fancytree-title",i.span),d={node:i,tree:r,options:r.options,isNew:e(i[r.statusClassPropName]).hasClass("fancytree-edit-new"),orgTitle:i.title,input:null,dirty:!1};if(!1===a.beforeEdit.call(i,{type:"beforeEdit"},d))return!1;e.ui.fancytree.assert(!s.currentNode,"recursive edit"),s.currentNode=this,s.eventData=d,r.widget._unbind(),e(document).on("mousedown.fancytree-edit",function(t){e(t.target).hasClass("fancytree-edit-input")||i.editEnd(!0,t)}),t=e("<input />",{class:"fancytree-edit-input",type:"text",value:r.options.escapeTitles?d.orgTitle:n(d.orgTitle)}),s.eventData.input=t,null!=a.adjustWidthOfs&&t.width(o.width()+a.adjustWidthOfs),null!=a.inputCss&&t.css(a.inputCss),o.html(t),t.focus().change(function(e){t.addClass("fancytree-edit-dirty")}).keydown(function(t){switch(t.which){case e.ui.keyCode.ESCAPE:i.editEnd(!1,t);break;case e.ui.keyCode.ENTER:return i.editEnd(!0,t),!1}t.stopPropagation()}).blur(function(e){return i.editEnd(!0,e)}),a.edit.call(i,{type:"edit"},d)},e.ui.fancytree._FancytreeNodeClass.prototype.editEnd=function(t,n){var r,s=this,a=this.tree,o=a.ext.edit,d=o.eventData,c=a.options.edit,l=e(".fancytree-title",s.span),u=l.find("input.fancytree-edit-input");return c.trim&&u.val(e.trim(u.val())),r=u.val(),d.dirty=r!==s.title,d.originalEvent=n,!1===t?d.save=!1:d.isNew?d.save=""!==r:d.save=d.dirty&&""!==r,!1!==c.beforeClose.call(s,{type:"beforeClose"},d)&&((!d.save||!1!==c.save.call(s,{type:"save"},d))&&(u.removeClass("fancytree-edit-dirty").off(),e(document).off(".fancytree-edit"),d.save?(s.setTitle(a.options.escapeTitles?r:i(r)),s.setFocus()):d.isNew?(s.remove(),s=d.node=null,o.relatedNode.setFocus()):(s.renderTitle(),s.setFocus()),o.eventData=null,o.currentNode=null,o.relatedNode=null,a.widget._bind(),e(a.$container).focus(),d.input=null,c.close.call(s,{type:"close"},d),!0))},e.ui.fancytree._FancytreeNodeClass.prototype.editCreateNode=function(t,i){var n,r=this.tree,s=this;t=t||"child",null==i?i={title:""}:"string"==typeof i?i={title:i}:e.ui.fancytree.assert(e.isPlainObject(i)),"child"!==t||this.isExpanded()||!1===this.hasChildren()?(n=this.addNode(i,t),n.match=!0,e(n[r.statusClassPropName]).removeClass("fancytree-hide").addClass("fancytree-match"),n.makeVisible().done(function(){e(n[r.statusClassPropName]).addClass("fancytree-edit-new"),s.tree.ext.edit.relatedNode=s,n.editStart()})):this.setExpanded().done(function(){s.editCreateNode(t,i)})},e.ui.fancytree._FancytreeClass.prototype.isEditing=function(){return this.ext.edit?this.ext.edit.currentNode:null},e.ui.fancytree._FancytreeNodeClass.prototype.isEditing=function(){return!!this.tree.ext.edit&&this.tree.ext.edit.currentNode===this},e.ui.fancytree.registerExtension({name:"edit",version:"2.30.0",options:{adjustWidthOfs:4,allowEmpty:!1,inputCss:{minWidth:"3em"},triggerStart:["f2","mac+enter","shift+click"],trim:!0,beforeClose:e.noop,beforeEdit:e.noop,close:e.noop,edit:e.noop,save:e.noop},currentNode:null,treeInit:function(e){this._superApply(arguments),this.$container.addClass("fancytree-ext-edit")},nodeClick:function(t){var i=e.ui.fancytree.eventToString(t.originalEvent),n=t.options.edit.triggerStart;return"shift+click"===i&&e.inArray("shift+click",n)>=0&&t.originalEvent.shiftKey?(t.node.editStart(),!1):"click"===i&&e.inArray("clickActive",n)>=0&&t.node.isActive()&&!t.node.isEditing()&&e(t.originalEvent.target).hasClass("fancytree-title")?(t.node.editStart(),!1):this._superApply(arguments)},nodeDblclick:function(t){return e.inArray("dblclick",t.options.edit.triggerStart)>=0?(t.node.editStart(),!1):this._superApply(arguments)},nodeKeydown:function(i){switch(i.originalEvent.which){case 113:if(e.inArray("f2",i.options.edit.triggerStart)>=0)return i.node.editStart(),!1;break;case e.ui.keyCode.ENTER:if(e.inArray("mac+enter",i.options.edit.triggerStart)>=0&&t)return i.node.editStart(),!1}return this._superApply(arguments)}}),e.ui.fancytree});